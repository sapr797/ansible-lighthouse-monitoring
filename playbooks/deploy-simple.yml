---
- name: üöÄ –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Lighthouse —Å—Ç–µ–∫–∞
  hosts: localhost
  connection: local
  become: yes

  tasks:
    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ClickHouse —á–µ—Ä–µ–∑ —Ä–æ–ª—å
      include_role:
        name: clickhouse
      vars:
        clickhouse_version: "22.8"

    - name: ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ ClickHouse
      wait_for:
        port: 8123
        delay: 5
        timeout: 60

    - name: üìä –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vector —á–µ—Ä–µ–∑ —Ä–æ–ª—å
      include_role:
        name: vector

    - name: üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Lighthouse —á–µ—Ä–µ–∑ —Ä–æ–ª—å
      include_role:
        name: lighthouse

    - name: üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-–¥–æ—Å—Ç—É–ø–∞
      apt:
        name: nginx
        state: present
      notify: restart nginx

    - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
      debug:
        msg: "–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: http://localhost:8080"

  handlers:
    - name: restart nginx
      systemd:
        name: nginx
        state: restarted
